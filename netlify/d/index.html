<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AES-URL</title>
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <h1>AES-URL</h1>
    <br>
    <div id="output"></div>
    <br>
    <a href="../">AES-URLとは</a>
    <br>
        <hr style="margin: 2em 0; border: none; border-top: 1px solid #ccc;">
        <h3>Credit</h3>
        <p>AES-URL ver.3.1.1</p>
        <p>Github <a href="https://github.com/kado-kado/AES_Encrypted_URL_Disguiser" target="_blank">Repository</a></p>
        <p>npm <a href="https://www.npmjs.com/package/aes-url" target="_blank">npmjs</a></p>
        <p>Made by <a href="https://github.com/kado-kado" target="_blank">@kado-kado</a></p>
        <h4>Special Thanks</h4>
        <p>AES Encryption by <a href="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js" target="_blank">CryptoJS</a></p>
        <p>URL-safe encoding with <a href="https://en.wikipedia.org/wiki/Base64#URL_applications" target="_blank">Base64url</a></p>
        <p>Powered by <a href="https://fonts.google.com/specimen/Zen+Maru+Gothic" target="_blank">Google Fonts(Zen Maru Gothic)</a></p>
        <p>Hosted source on <a href="https://github.com/" target="_blank">GitHub</a></p>
        <p>Deployed by <a href="https://www.netlify.com/" target="_blank">Netlify</a></p>
    <script>
    window.onload = function () {
        const hash = window.location.hash.substring(1);
        const output = document.getElementById("output");

        if (!hash) {
            output.textContent = "暗号化されたフラグメントが見つかりません。";
            return;
        }

        const key = prompt("復号キーを入力してください:");
        if (!key) {
            output.textContent = "復号キーが入力されていません。";
            return;
        }

        try {
            const base64 = hash
                .replace(/-/g, '+')
                .replace(/_/g, '/')
                .padEnd(hash.length + (4 - hash.length % 4) % 4, '=');

            const decrypted = CryptoJS.AES.decrypt(base64, key).toString(CryptoJS.enc.Utf8);
            if (!decrypted) throw new Error("復号結果が空です");

            const header = document.createElement("h3");
            header.textContent = "Decode";
            output.appendChild(header);

            const lineBreak = document.createElement("br");
            output.appendChild(lineBreak);

            const link = document.createElement("a");
            link.href = decrypted;
            link.target = "_blank";
            link.rel = "noopener noreferrer";
            link.textContent = decrypted;

            if (!/^https?:\/\//i.test(decrypted)) {
                throw new Error("不正なリンク形式です。httpまたはhttpsで始まるURLのみ許可されています。");
            }

            output.appendChild(link);
        } catch (e) {
            output.textContent = "復号に失敗しました。キーが間違っているか、データが不正です。";
            console.error(e);
        }
    };
</script>
</body>
</html>